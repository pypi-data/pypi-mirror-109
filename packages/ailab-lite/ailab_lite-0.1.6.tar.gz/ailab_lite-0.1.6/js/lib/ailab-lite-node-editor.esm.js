import e from"rete";import t from"rete-vue-render-plugin";import o from"rete-connection-plugin";import s from"rete-area-plugin";import n from"rete-history-plugin";import a from"rete-connection-mastery-plugin";import i from"rete-keyboard-plugin";import r from"rete-minimap-plugin";import l from"rete-auto-arrange-plugin";import d from"rete-vue-render-plugin/src/mixin";import{getObjectValueByPath as c}from"vuetify/lib/util/helpers";import{PerfectScrollbar as u}from"vue2-perfect-scrollbar";import p from"vue";import h from"@koumoul/vjsf";import"@koumoul/vjsf/dist/main.css";var m={props:["readonly","emitter","ikey","getData","putData","possibleValues","selectedValues"],template:'<v-layout row wrap no-gutters>\n        <v-col md="5">\n            <v-subheader dark>{{ikey}}</v-subheader>\n        </v-col>\n        <v-col>\n            <v-select \n            solo \n            flat\n            v-model="selectedValues" \n            :items="possibleValues" \n            @input="change($event)" \n            @dblclick.stop="" \n            @pointermove.stop=""></v-select>\n        </v-col>\n      </v-layout>',data:()=>({value:0,model:""}),methods:{change(e){this.update()},update(){this.ikey&&this.putData(this.ikey,this.model),this.emitter.trigger("process")}},mounted(){this.model=this.selectedValues,void 0!==this.getData(this.ikey)&&(this.model=this.getData(this.ikey)),this.update()}};class v extends e.Control{constructor(e,t,o,s,n){super(t),this.component=m,this.props={emitter:e,ikey:t,readonly:n,possibleValues:s,selectedValues:o}}setValue(e){this.vueContext.value=e}}const f=new e.Socket("timeseries"),_=new e.Socket("dataframe"),g=new e.Socket("Integer value"),y=new e.Socket("Number value"),b=new e.Socket("Timeseries"),k=new e.Socket("Any");f.combineWith(k),_.combineWith(k),g.combineWith(k),y.combineWith(k),b.combineWith(k),k.combineWith(k);var w={props:["emitter","ikey","getData","putData","default","node"],template:'\n    <v-layout row wrap style="width:700px; height:50px">\n        <v-col cols=3>\n        <v-combobox\n          @change=\'change\'\n          v-model="itemsChosen"\n          :items="items"\n          label="Aggregation method"\n          multiple\n          solo\n          flat\n          width="auto"\n        ></v-combobox>\n        </v-col>\n        <v-col cols=2>\n            <v-text-field \n            @change=\'change\'\n            v-model="periodLength"\n            solo \n            flat/>\n        </v-col>\n        <v-col cols=3>\n        <v-combobox\n          @change=\'change\'\n          width="auto"\n          v-model="periodChosen"\n          :items="period"\n          label="Time resolution"\n          solo \n          flat\n        ></v-combobox>\n        </v-col>\n        <v-col>\n        <v-btn small color="green" @click="add($event)" @dblclick.stop="">Add</v-btn>\n        <v-btn small color="red" @click="remove($event)" @dblclick.stop="">Delete</v-btn>\n        </v-col>\n    </v-layout>\n    ',data:()=>({value:"",title:"",items:["count","sum","mean","median","var","std","min","max","skew","kurt"],itemsChosen:[],period:["seconds","minutes","hours","days"],periodChosen:void 0,controls:[],periodLength:0}),methods:{change(e){this.update()},update(){console.log("change"),this.ikey&&this.putData(this.ikey,{itemsChosen:this.itemsChosen,periodChosen:this.periodChosen,periodLength:this.periodLength}),this.emitter.editor.trigger("process")},add(){this.emitter.add()},remove(){this.emitter.remove(this.ikey)}},mounted(){this.value=this.default,this.title=this.caption,this.update()}};class C extends e.Control{constructor(e,t){super(t),this.component=w,this.props={emitter:e,ikey:t,caption:t}}setValue(e){this.vueContext.value=e}}class x extends e.Component{constructor(){super("RollingAggregation"),this.className="RollingAggregation",this.humanModule="fathom_lib.transformers.rolling_aggregation",this.pyModule="fathom_lib.transformers.rolling_aggregation",this.controls={},this.node=void 0}builder(t){return this.node=t,t.addControl(new v(this.editor,"timestamp",null,[],!1)),t.addControl(new v(this.editor,"id",null,[],!1)),t.addInput(new e.Input("default","",k,!0)),t.addOutput(new e.Output("default","",k,!0)),this.add(),t.className=this.className,t.humanModule=this.humanModule,t.pyModule=this.pyModule,t.is_dataframe=!1,this.node}add(){var e=Object.keys(this.controls).length,t=new C(this,"aggregation"+e);this.controls[e]=t,this.node.addControl(t),this.editor.trigger("process"),this.node.update()}remove(e){this.node.controls.delete(e),this.node.update(),this.editor.trigger("process")}}var N={props:["readonly","emitter","ikey","getData","putData","default","caption"],template:'<v-layout row wrap no-gutters>\n        <v-col md="5">\n            <v-subheader dark>{{title}}</v-subheader>\n        </v-col>\n        <v-col>\n            <v-text-field solo flat :title="title" :value="value" @input="change($event)" :readonly="readonly" @dblclick.stop="" @pointerdown.stop="" @pointermove.stop="" ></v-text-field>\n        </v-col>\n    </v-layout>',data:()=>({value:"",title:""}),methods:{change(e){this.value=e,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.value=this.default,this.title=this.caption,this.update()}};class S extends e.Control{constructor(e,t,o,s){super(t),this.component=N,this.props={emitter:e,ikey:t,readonly:s,default:o,caption:t}}setValue(e){this.vueContext.value=e}}class E extends e.Component{constructor(e){super("DynamicDataFrame"),this.className="DataFrame",this.humanModule="fathom_lib.datasources",this.pyModule="fathom_lib.datasources",this.name=e.name,this.schema=JSON.parse(e.schema_json)}builder(t){let o=this.schema.fields.map((e=>e.name));return t.addControl(new v(this.editor,"X_columns",o,o,!1)),t.addControl(new v(this.editor,"y_columns",[],o,!1)),t.addControl(new v(this.editor,"additional_columns",[],o,!1)),t.addOutput(new e.Output("default","",k)),t.className=this.className,t.humanModule=this.humanModule,t.pyModule=this.pyModule,t.schema_json=this.schema.fields,t.is_dataframe=!0,t}}var D={props:["readonly","emitter","ikey","getData","putData","default","caption"],template:'<v-layout row wrap no-gutters>\n        <v-col md="5">\n            <v-subheader dark>{{title}}</v-subheader>\n        </v-col>\n        <v-col>\n            <v-checkbox dense shaped dark  v-model="value" @input="change($event)" @dblclick.stop="" @pointermove.stop=""></v-checkbox>\n        </v-col>\n       </v-layout>',data:()=>({value:"",title:""}),methods:{change(e){this.value=e,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.value=this.default,this.title=this.caption,this.update()}};class M extends e.Control{constructor(e,t,o,s){super(t),this.component=D,this.props={emitter:e,ikey:t,readonly:s,default:o,caption:t}}setValue(e){this.vueContext.value=e}}var O={props:["readonly","emitter","ikey","getData","putData","value"],template:'<v-layout row wrap no-gutters>\n        <v-col md="5">\n            <v-subheader dark>{{ikey}}</v-subheader>\n        </v-col>\n        <v-col>\n            <v-text-field type="number" step="any" solo flat :value="value" @input="change($event)" @dblclick.stop="" @pointermove.stop=""></v-text-field>\n        </v-col>\n      </v-layout>',data:()=>({}),methods:{change(e){this.value=e,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.update()}};class $ extends e.Control{constructor(e,t,o,s){super(t),this.component=O,this.props={emitter:e,ikey:t,readonly:s,value:o}}setValue(e){this.vueContext.value=e}}var j={props:["readonly","emitter","ikey","getData","putData","value"],template:'<v-layout row wrap no-gutters>\n        <v-col md="5">\n            <v-subheader dark>{{ikey}}</v-subheader>\n        </v-col>\n        <v-col>\n            <v-text-field type="number" pattern="[0-9]" step="1" solo flat :value="value" @input="change($event)" @dblclick.stop="" @pointermove.stop=""></v-text-field>\n        </v-col>\n      </v-layout>',data:()=>({}),methods:{change(e){this.value=e,this.update()},update(){this.ikey&&this.putData(this.ikey,this.value),this.emitter.trigger("process")}},mounted(){this.update()}};class R extends e.Control{constructor(e,t,o,s){super(t),this.component=j,this.props={emitter:e,ikey:t,readonly:s,value:o}}setValue(e){this.vueContext.value=e}}class P extends e.Component{constructor(e){super("DynamicComponent"),this.className=e.name,this.name=e.js_name,this.humanModule=e.human_module,this.pyModule=e.py_module,this.params=e.params,this.input_list=e.input_list,this.output_list=e.output_list}builder(t){return Object.keys(this.params).forEach((e=>{let o=this.params[e],s="float"==(n=null!=o.types[0]?o.types[0]:null)?$:"bool"==n?M:"int"==n?R:"string"==n?S:null==n?v:S;var n;s==v?t.addControl(new s(this.editor,o.name,o.default,o.choices,!1)):t.addControl(new s(this.editor,o.name,o.default,!1))})),t.addInput(new e.Input("default","",k,!0)),t.addOutput(new e.Output("default","",k,!0)),t.className=this.className,t.humanModule=this.humanModule,t.pyModule=this.pyModule,t.is_dataframe=!1,t}}function X(e,t,o,s,n,a,i,r,l,d){"boolean"!=typeof i&&(l=r,r=i,i=!1);const c="function"==typeof o?o.options:o;let u;if(e&&e.render&&(c.render=e.render,c.staticRenderFns=e.staticRenderFns,c._compiled=!0,n&&(c.functional=!0)),s&&(c._scopeId=s),a?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,l(e)),e&&e._registeredComponents&&e._registeredComponents.add(a)},c._ssrRegister=u):t&&(u=i?function(e){t.call(this,d(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,r(e))}),u)if(c.functional){const e=c.render;c.render=function(t,o){return u.call(o),e(t,o)}}else{const e=c.beforeCreate;c.beforeCreate=e?[].concat(e,u):[u]}return o}const A="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function F(e){return(e,t)=>function(e,t){const o=A?t.media||"default":e,s=T[o]||(T[o]={ids:new Set,styles:[]});if(!s.ids.has(e)){s.ids.add(e);let o=t.source;if(t.map&&(o+="\n/*# sourceURL="+t.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),s.element||(s.element=document.createElement("style"),s.element.type="text/css",t.media&&s.element.setAttribute("media",t.media),void 0===V&&(V=document.head||document.getElementsByTagName("head")[0]),V.appendChild(s.element)),"styleSheet"in s.element)s.styles.push(o),s.element.styleSheet.cssText=s.styles.filter(Boolean).join("\n");else{const e=s.ids.size-1,t=document.createTextNode(o),n=s.element.childNodes;n[e]&&s.element.removeChild(n[e]),n.length?s.element.insertBefore(t,n[e]):s.element.appendChild(t)}}}(e,t)}let V;const T={};const L=X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"node",class:e._f("kebab")([e.selected(),e.node.name,e.getNodeClass()]),attrs:{id:e.node.id}},[o("v-sheet",{staticClass:"pa-4",attrs:{color:"rgba(36, 184, 208, 0)"}},[o("div",{attrs:{id:"title-wrapper"}},[o("div",{staticClass:"left"},[o("div",{staticClass:"title"},[e._v(e._s(e.node.name)+" "),o("span",{staticClass:"progress"})])]),e._v(" "),o("div",{staticClass:"right"},["start"===e.status?o("div",[o("v-progress-circular",{attrs:{color:"white",indeterminate:""}})],1):o("div",{staticClass:"right"},[o("v-icon",{attrs:{color:e.statusColor}},[e._v("mdi-checkbox-blank-circle")])],1)])]),e._v(" "),""!==e.errorMessage?o("v-alert",{staticClass:"alertmessage",attrs:{"max-width":"300px",type:"error"}},[e._v(e._s(e.errorMessage))]):e._e()],1),e._v(" "),e._l(e.outputs(),(function(t){return o("div",{staticClass:"output"},[o("div",{staticClass:"output-title"},[e._v(e._s(t.name))]),e._v(" "),o("Socket",{directives:[{name:"socket",rawName:"v-socket:output",value:t,expression:"output",arg:"output"}],attrs:{type:"output",socket:t.socket}})],1)})),e._v(" "),e._l(e.controls(),(function(e){return o("div",{directives:[{name:"control",rawName:"v-control",value:e,expression:"control"}],staticClass:"control",staticStyle:{display:"none"}})})),e._v(" "),e._l(e.inputs(),(function(t){return o("div",{staticClass:"input"},[o("Socket",{directives:[{name:"socket",rawName:"v-socket:input",value:t,expression:"input",arg:"input"}],attrs:{type:"input",socket:t.socket}}),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:!t.showControl(),expression:"!input.showControl()"}],staticClass:"input-title"},[e._v(e._s(t.name))]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:t.showControl(),expression:"input.showControl()"},{name:"control",rawName:"v-control",value:t.control,expression:"input.control"}],staticClass:"input-control"})],1)}))],2)},staticRenderFns:[]},undefined,{mixins:[d],props:[status],components:{Socket:X({render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("div",{staticClass:"socket",class:e._f("kebab")([e.type,e.socket.name]),attrs:{title:e.socket.name}})},staticRenderFns:[]},(function(e){e&&e("data-v-0dd0170d_0",{source:".socket[data-v-0dd0170d]{display:inline-block;cursor:pointer;border:1px solid #fff;border-radius:12px;width:24px;height:24px;margin:6px;vertical-align:middle;background:#96b38a;z-index:2;box-sizing:border-box}.socket[data-v-0dd0170d]:hover{border-width:4px}.socket.multiple[data-v-0dd0170d]{border-color:#ff0}.socket.output[data-v-0dd0170d]{margin-right:-12px}.socket.input[data-v-0dd0170d]{margin-left:-12px}",map:void 0,media:void 0})}),{props:["type","socket"]},"data-v-0dd0170d",false,undefined,!1,F,void 0,void 0)},data:function(){return{status:"waiting",errorMessage:""}},computed:{statusColor:function(){return"end"===this.status?"green":"error"===this.status||"failed"==this.status?"red":"grey"}},methods:{getNodeClass:()=>"default-node-color",setStatus(e){this.status=e},setMessage(e){this.errorMessage=e}}},"data-v-fc06b154",false,undefined,!1,void 0,void 0,void 0);const I=X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("v-text-field",{attrs:{label:"Search",flat:"","hide-details":"",clearable:"","clear-icon":"mdi-close-circle-outline"},on:{"click:clear":function(t){return e.componentsInputClear()}},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),o("v-checkbox",{staticClass:"mb-5",attrs:{"hide-details":"",label:"Case sensitive"},model:{value:e.caseSensitive,callback:function(t){e.caseSensitive=t},expression:"caseSensitive"}}),e._v(" "),o("perfect-scrollbar",[o("v-treeview",{ref:"treeview",staticClass:"components-tree-view",attrs:{"item-key":"name","open-on-click":!0,items:e.items,search:e.search,filter:e.filter,open:e.open,active:e.active,activatable:"","return-object":""},on:{"update:open":function(t){e.open=t},"update:active":function(t){e.active=t}},scopedSlots:e._u([{key:"prepend",fn:function(t){return[t.item.children?o("v-icon",{domProps:{textContent:e._s("mdi-folder-network")}}):e._e()]}}])})],1)],1)},staticRenderFns:[]},(function(e){e&&e("data-v-16681e6a_0",{source:".ps{overflow:hidden!important;overflow-anchor:none;-ms-overflow-style:none;touch-action:auto;-ms-touch-action:auto}.ps__rail-x{display:none;opacity:0;transition:background-color .2s linear,opacity .2s linear;-webkit-transition:background-color .2s linear,opacity .2s linear;height:15px;bottom:0;position:absolute}.ps__rail-y{display:none;opacity:0;transition:background-color .2s linear,opacity .2s linear;-webkit-transition:background-color .2s linear,opacity .2s linear;width:15px;right:0;position:absolute}.ps--active-x>.ps__rail-x,.ps--active-y>.ps__rail-y{display:block;background-color:transparent}.ps--focus>.ps__rail-x,.ps--focus>.ps__rail-y,.ps--scrolling-x>.ps__rail-x,.ps--scrolling-y>.ps__rail-y,.ps:hover>.ps__rail-x,.ps:hover>.ps__rail-y{opacity:.6}.ps .ps__rail-x.ps--clicking,.ps .ps__rail-x:focus,.ps .ps__rail-x:hover,.ps .ps__rail-y.ps--clicking,.ps .ps__rail-y:focus,.ps .ps__rail-y:hover{background-color:#eee;opacity:.9}.ps__thumb-x{background-color:#aaa;border-radius:6px;transition:background-color .2s linear,height .2s ease-in-out;-webkit-transition:background-color .2s linear,height .2s ease-in-out;height:6px;bottom:2px;position:absolute}.ps__thumb-y{background-color:#aaa;border-radius:6px;transition:background-color .2s linear,width .2s ease-in-out;-webkit-transition:background-color .2s linear,width .2s ease-in-out;width:6px;right:2px;position:absolute}.ps__rail-x.ps--clicking .ps__thumb-x,.ps__rail-x:focus>.ps__thumb-x,.ps__rail-x:hover>.ps__thumb-x{background-color:#999;height:11px}.ps__rail-y.ps--clicking .ps__thumb-y,.ps__rail-y:focus>.ps__thumb-y,.ps__rail-y:hover>.ps__thumb-y{background-color:#999;width:11px}@supports (-ms-overflow-style:none){.ps{overflow:auto!important}}@media screen and (-ms-high-contrast:active),(-ms-high-contrast:none){.ps{overflow:auto!important}}.ps{position:relative}",map:void 0,media:void 0})}),{props:["items"],components:{PerfectScrollbar:u},methods:{componentsInputClear:function(){this.$refs.treeview.updateAll(!1)},onItemClick(e){this.$emit("itemClicked",e)}},watch:{active:function(){this.active.length>0&&(this.onItemClick(this.active[0]),this.active=[])},search:function(){this.search&&this.search.length>3?this.$refs.treeview.updateFoundNodes(!0):this.$refs.treeview.updateFoundNodes(!1)}},computed:{filter(){return this.caseSensitive?(e,t,o)=>e[o].indexOf(t)>-1:void 0}},mounted:function(){this.$refs.treeview.updateFoundNodes=e=>{let t=this.$refs.treeview.nodes,o=Object.keys(t);o=o.filter((e=>!this.$refs.treeview.excludedItems.has(e))),o.forEach((o=>this.$refs.treeview.updateOpen(c(t[o].item,this.$refs.treeview.itemKey),e))),this.$refs.treeview.emitOpen()}},data:function(){return{search:null,caseSensitive:!1,active:[],open:[]}}},undefined,false,undefined,!1,F,void 0,void 0);var J={props:["node"],components:{NodeControlPanelForm:X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-card",{staticClass:"pa-3"},[o("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[o("v-jsf",{attrs:{schema:e.vjsfSchema,options:e.options},on:{change:e.changeForm},model:{value:e.controls,callback:function(t){e.controls=t},expression:"controls"}},[e._l(e.errorMessagesDict,(function(t,s){return o("template",{slot:s+"-after"},[o("span",{key:s,style:{color:e.$vuetify.theme.themes.light.fathomRed}},[e._v(e._s(e.errorMessagesDict[s]))])])}))],2)],1)],1)},staticRenderFns:[]},undefined,{extends:X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-card",[o("v-card-title",[e._v(e._s(e.formName))]),e._v(" "),o("v-card-text",[o("v-container",{attrs:{fluid:""}},[e.errorMessages?o("v-card",{staticClass:"errors",style:{color:e.$vuetify.theme.themes.light.fathomWhite},attrs:{color:"fathomRed",type:"error"}},[o("v-card-title",[e._v(" Validation errors ")]),e._v(" "),o("v-card-subtitle",{style:{color:e.$vuetify.theme.themes.light.fathomWhite}},[e._v("\n          See details below\n        ")])],1):e._e(),e._v(" "),o("v-form",{ref:"form",model:{value:e.valid,callback:function(t){e.valid=t},expression:"valid"}},[o("v-jsf",{attrs:{schema:e.vjsfSchema,options:e.options},model:{value:e.model,callback:function(t){e.model=t},expression:"model"}},[e._l(e.errorMessagesDict,(function(t,s){return o("template",{slot:s+"-after"},[o("span",{key:s,style:{color:e.$vuetify.theme.themes.light.fathomRed}},[e._v(e._s(e.errorMessagesDict[s]))])])}))],2)],1)],1)],1),e._v(" "),o("v-card-actions",[o("v-spacer"),e._v(" "),o("v-btn",{attrs:{color:"primary",text:""},on:{click:e.cancel}},[e._v("Close")]),e._v(" "),o("v-btn",{attrs:{color:"primary",text:""},on:{click:e.save}},[e._v("Save")])],1)],1)},staticRenderFns:[]},undefined,p.extend({props:["id","formName","schema","url","order"],created(){this.initData()},mounted(){},data:()=>({model:{},valid:!1,dialog:!1,errorMessages:"",errorMessagesDict:{},options:{tooltipProps:{left:!0,openOnHover:!0,openOnClick:!1}}}),watch:{id(e){this.initData()}},computed:{vjsfSchema(){return this.orderedSchema(this.schema.vuetify_json_schema)},properties(){return this.schema.vuetify_json_schema.properties},retrieveUrl(){return this.schema.retrieve_url.replace("%(pk)s",this.id)},orderedProperties(){return function(e,t){if(!Array.isArray(t))return e;const o=e=>e.reduce(((e,t)=>(e[t]=!0,e)),{}),s=o(e),n=t.filter((e=>"*"===e||s[e])),a=o(n),i=e.filter((e=>!a[e])),r=n.indexOf("*");if(-1===r){if(i.length)throw new Error("uiSchema order list does not contain "+((l=i).length>1?`properties '${l.join("', '")}'`:`property '${l[0]}'`));return n}var l;if(r!==n.lastIndexOf("*"))throw new Error("uiSchema order list contains more than one wildcard item");const d=[...n];return d.splice(r,1,...i),d}(Object.keys(this.properties),this.order)}},methods:{orderedSchema(e){if(!this.order)return e;const{orderedProperties:t}=this,o=JSON.parse(JSON.stringify(e));return o.properties={},t.map((t=>(o.properties[t]={},Object.assign(o.properties[t],e.properties[t]),null))),o},initData(){this.model={}},cancel(){this.$emit("closeDialog")},save(){this.errorMessagesDict={},this.$refs.form.validate(),this.valid}},components:{VJsf:h}}),"data-v-6bb78746",false,undefined,!1,void 0,void 0,void 0),props:["node","controls"],methods:{changeForm(){this.$emit("controlDataChange",this.controls)}},computed:{vjsfSchema(){return this.orderedSchema(this.schema)},properties(){return this.schema.properties}}},undefined,false,undefined,!1,void 0,void 0,void 0)},data:()=>({showPreview:!1,dataset:null,tab:null,items:[],headers:[],datasets:[],showSelectedColumns:!0}),computed:{show(){return null!=this.node},name(){return this.node?.name},schema(){return this.node?.schema},doc(){return this.node?.doc},controls(){return this.prepareControlData(this.node?.node)},order(){return this.node?.order},isDataframe:()=>!1},watch:{isDataframe(e,t){},dataset(e,t){},showSelectedColumns(e){this.prepareHeaders()},tab(){this.prepareHeaders()}},methods:{closeClick(){this.$emit("closePanel"),this.tab=null},onControlDataChange(e){const t=t=>!Object.prototype.hasOwnProperty.call(e,t)&&("RollingAggregation"!==this.node.name||["timestamp","id"].includes(t));Object.keys(this.node.node.data).forEach((o=>{t(o)&&(e[o]=null)})),Object.keys(e).forEach((t=>{Array.isArray(e[t])&&t.startsWith("aggregation")?Array.from(e[t]).forEach(((e,o)=>{o+=1,this.node.node.data[t+o]=e})):this.node.node.data[t]=e[t]})),this.node.node.update()},prepareControlData(e){const t={};return e.controls.forEach(((o,s,n)=>{s.startsWith("aggregation")?t.aggregation=Array.isArray(t.aggregation)?t.aggregation.concat([e.data[s]]):[e.data[s]]:t[s]=e.data[s]})),t},prepareHeaders(){0!==this.items.length&&(this.headers=[...new Set(this.items.flatMap((e=>Object.keys(e))))].map((e=>({text:e,value:e}))),this.showSelectedColumns&&(this.headers=this.headers.filter((e=>[...this.node.node.data.X_columns,...this.node.node.data.y_columns,...this.node.node.data.additional_columns].includes(e.value)))))},clearPreview(){this.showPreview=!1,this.dataset=null,["items","headers"].forEach((e=>{this[e]=[]}))}}};const W=X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-layout",{attrs:{row:"",wrap:"","no-gutters":""}},[o("v-col",{staticClass:"left-control-panel-wrapper",attrs:{cols:"3"}},[o("v-expansion-panels",{attrs:{accordion:"",focusable:""},model:{value:e.leftPanel,callback:function(t){e.leftPanel=t},expression:"leftPanel"}},[o("v-expansion-panel",[o("v-expansion-panel-header",[e._v("\n          Datasets\n        ")]),e._v(" "),o("v-expansion-panel-content",[o("NodeComponents",{attrs:{items:e.dataframeComponents},on:{itemClicked:e.onTreeViewComponentClicked}})],1)],1),e._v(" "),o("v-expansion-panel",[o("v-expansion-panel-header",[e._v("\n          Components\n        ")]),e._v(" "),o("v-expansion-panel-content",[o("NodeComponents",{attrs:{items:e.nodeComponents},on:{itemClicked:e.onTreeViewComponentClicked}})],1)],1)],1)],1),e._v(" "),o("v-col",{staticClass:"node-editor-wrapper",attrs:{cols:"9"}},[o("div",{staticClass:"node-editor",attrs:{id:"rete"}}),e._v(" "),o("NodeControlPanel",{attrs:{node:e.selectedNode},on:{closePanel:e.onClosePanel}})],1)],1)},staticRenderFns:[]},undefined,{name:"app",props:{datasets:Array,componentSchemas:Array},components:{NodeComponents:I,NodeControlPanel:X({render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("v-col",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"node-control-panel",attrs:{cols:"4"}},[o("v-card",{staticClass:"card"},[o("perfect-scrollbar",[o("v-sheet",{staticClass:"pa-4 grey",class:{"lighten-2":!e.$vuetify.theme.dark,"darken-2":e.$vuetify.theme.dark}},[o("div",[e._v("\n          "+e._s(e.name)+"\n          "),o("v-icon",{staticClass:"float-right",on:{click:function(t){return e.closeClick()}}},[e._v(" mdi-close-circle-outline ")])],1)]),e._v(" "),o("v-card-text",[o("v-tabs",{attrs:{"background-color":"accent-4",centered:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[o("v-tab",{attrs:{href:"#node-controls"}},[e._v(" Controls ")]),e._v(" "),e.doc?o("v-tab",{attrs:{href:"#node-docs"}},[e._v(" Documentation ")]):e._e(),e._v(" "),e.isDataframe?o("v-tab",{attrs:{href:"#node-dataset-preview"}},[e._v(" Dataset preview ")]):e._e(),e._v(" "),o("v-tab-item",{attrs:{value:"node-controls"}},[e.schema?o("NodeControlPanelForm",{attrs:{controls:e.controls,schema:e.schema,order:e.order},on:{controlDataChange:e.onControlDataChange}}):e._e()],1),e._v(" "),e.doc?o("v-tab-item",{attrs:{value:"node-docs"}},[o("div",[o("pre",{staticStyle:{"white-space":"pre-wrap"},domProps:{innerHTML:e._s(e.doc)}})])]):e._e(),e._v(" "),e.isDataframe?o("v-tab-item",{attrs:{value:"node-dataset-preview"}},[o("v-switch",{attrs:{label:"Show selected columns"},model:{value:e.showSelectedColumns,callback:function(t){e.showSelectedColumns=t},expression:"showSelectedColumns"}}),e._v(" "),o("v-select",{attrs:{label:"Dataset",items:e.datasets,clearable:""},model:{value:e.dataset,callback:function(t){e.dataset=t},expression:"dataset"}}),e._v(" "),e.showPreview?o("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.items,"items-per-page":5}}):e._e()],1):e._e()],1)],1)],1)],1)],1)},staticRenderFns:[]},(function(e){e&&e("data-v-03b28b31_0",{source:".ps{overflow:hidden!important;overflow-anchor:none;-ms-overflow-style:none;touch-action:auto;-ms-touch-action:auto}.ps__rail-x{display:none;opacity:0;transition:background-color .2s linear,opacity .2s linear;-webkit-transition:background-color .2s linear,opacity .2s linear;height:15px;bottom:0;position:absolute}.ps__rail-y{display:none;opacity:0;transition:background-color .2s linear,opacity .2s linear;-webkit-transition:background-color .2s linear,opacity .2s linear;width:15px;right:0;position:absolute}.ps--active-x>.ps__rail-x,.ps--active-y>.ps__rail-y{display:block;background-color:transparent}.ps--focus>.ps__rail-x,.ps--focus>.ps__rail-y,.ps--scrolling-x>.ps__rail-x,.ps--scrolling-y>.ps__rail-y,.ps:hover>.ps__rail-x,.ps:hover>.ps__rail-y{opacity:.6}.ps .ps__rail-x.ps--clicking,.ps .ps__rail-x:focus,.ps .ps__rail-x:hover,.ps .ps__rail-y.ps--clicking,.ps .ps__rail-y:focus,.ps .ps__rail-y:hover{background-color:#eee;opacity:.9}.ps__thumb-x{background-color:#aaa;border-radius:6px;transition:background-color .2s linear,height .2s ease-in-out;-webkit-transition:background-color .2s linear,height .2s ease-in-out;height:6px;bottom:2px;position:absolute}.ps__thumb-y{background-color:#aaa;border-radius:6px;transition:background-color .2s linear,width .2s ease-in-out;-webkit-transition:background-color .2s linear,width .2s ease-in-out;width:6px;right:2px;position:absolute}.ps__rail-x.ps--clicking .ps__thumb-x,.ps__rail-x:focus>.ps__thumb-x,.ps__rail-x:hover>.ps__thumb-x{background-color:#999;height:11px}.ps__rail-y.ps--clicking .ps__thumb-y,.ps__rail-y:focus>.ps__thumb-y,.ps__rail-y:hover>.ps__thumb-y{background-color:#999;width:11px}@supports (-ms-overflow-style:none){.ps{overflow:auto!important}}@media screen and (-ms-high-contrast:active),(-ms-high-contrast:none){.ps{overflow:auto!important}}.ps{position:relative}",map:void 0,media:void 0})}),J,undefined,false,undefined,!1,F,void 0,void 0)},data:function(){return{editor:null,engine:null,nodeComponents:[],dataframeComponents:[],selectedNode:null,messages:[""],leftPanel:0,nodeStartX:null,nodeStartY:null}},async mounted(){this.initReteEditor(),this.registerComponents(this.componentSchemas,P,this.nodeComponents),this.editor.addNode(await this.editor.components.get("RollingAggregation").createNode()),this.editor.clear(),this.initReteEditorEvents()},methods:{initDatasets:function(){this.registerComponents(this.datasets,E,this.dataframeComponents)},initReteEditor:function(){this.allocatePath;var d=document.querySelector("#rete");const c=document.createElement("div");c.classList="background",this.editor=new e.NodeEditor("demo@0.1.0",d),this.editor.use(o),this.editor.use(t,{component:L,options:{vuetify:vuetify}}),this.editor.use(i),this.editor.use(s,{background:c}),this.editor.use(n),this.editor.use(a),this.editor.use(r),this.editor.use(l,{margin:{x:50,y:50},depth:0}),this.engine=new e.Engine("demo@0.1.0")},initReteEditorEvents:function(){this.editor.on("process nodecreated noderemoved connectioncreated connectionremoved",(async()=>{this.editor.silent||(await this.engine.abort(),await this.engine.process(this.editor.toJSON()))})),this.editor.on("nodecreated noderemoved",(e=>{this.nodeClickHandlers()})),this.editor.on("noderemoved",(e=>{this.selectedNode&&e==this.selectedNode.node&&this.onClosePanel()})),this.editor.on("connectioncreated",(e=>{this.onConnectionCreated(e)})),this.editor.on("connectionremoved",(e=>{this.onConnectionRemoved(e)})),this.editor.on("zoom",(({source:e})=>"dblclick"!==e)),this.editor.view.resize(),s.zoomAt(this.editor),this.editor.trigger("process")},findComponentSchema:function(e){if(e.is_dataframe)return function(e){let t={name:e.name,doc:null,json_schema_form:{type:"object",properties:{X_columns:{title:"X columns",type:"array",items:{type:"string"},"x-props":{"small-chips":!0}},y_columns:{title:"Y columns",type:"array",items:{type:"string"},"x-props":{"small-chips":!0}},additional_columns:{title:"Additional columns",type:"array",items:{type:"string"},"x-props":{"small-chips":!0}}}}};if(e.schema_json){let o=e.schema_json.map((e=>e.name));Object.keys(t.json_schema_form.properties).forEach((e=>{t.json_schema_form.properties[e].items.enum=o}))}return t}(e);{let t=this.componentSchemas.find((t=>t.js_name===e.name));return t||null}},importGraph:function(e,t){return this.editor.fromJSON(e).then((()=>{Object.keys(t.nodes).forEach((e=>{var o=this.editor.nodes.find((o=>o.id===t.nodes[e].id));for(let s in t.nodes[e].data)o.data[s]=t.nodes[e].data[s];o.update()}))}))},exportGraph:function(){const e={},t={};var o=this.editor.toJSON(),s=JSON.parse(JSON.stringify(o));Object.keys(s.nodes).map((o=>{const n=s.nodes[o];var a=this.editor.nodes.find((e=>e.id===s.nodes[o].id));if(t[o]={name:a.className,parameters:n.data,module:a.pyModule},e[o]=n,a.is_dataframe&&(t[o].schema_json={fields:a.schema_json},t[o].data_columns=t[o].parameters,t[o].parameters={}),t[o].parameters.hasOwnProperty("X_columns")&&(t[o].data_columns={X_columns:t[o].parameters.X_columns},delete t[o].parameters.X_columns),"RollingAggregation"==t[o].name){let e=["timestamp","id"];t[o].data_mapping={},e.forEach((e=>{t[o].parameters.hasOwnProperty(e)&&(t[o].data_mapping[e]=t[o].parameters[e],delete t[o].parameters[e])}))}}));var n=[];return Object.keys(s.nodes).forEach((t=>{const o=s.nodes[t],a=e[t];Object.keys(o.outputs).forEach((t=>{o.outputs[t].connections.forEach((o=>{const s=o.node,i=(o.data,a.outputs[t]),r=e[s].inputs[o.input];i.connections.forEach((e=>{r.connections.forEach((t=>{n.push([t.node,t.output,e.node,e.input])}))}))}))}))})),{nodes:t,edges:n,rete:o}},clearGraph:function(){this.editor.clear()},fitGraphToScreen:function(){this.editor.view.resize(),s.zoomAt(this.editor)},autoArrangeGraph:function(){this.editor.trigger("arrange"),this.fitGraphToScreen()},resetStatuses:function(){this.editor.nodes.forEach((e=>{e.vueContext.status="pending",e.vueContext.errorMessage=""}))},startStatuses:function(){this.editor.nodes.forEach((e=>{e.vueContext.status="start",e.vueContext.errorMessage=""}))},clear:function(e){for(var t=document.getElementById("messages"),o=t.lastElementChild;o;)t.removeChild(o),o=t.lastElementChild;this.resetStatuses()},addComponentToTreeView:function(e,t,o=[],s=[]){let n=s;for(let e of o){let t=n.find((t=>t.name===e));t||(t={name:e,children:[]},n.push(t)),n=t.children||(t.children=[])}n.push({name:e,onClick:t})},registerComponents:function(e=[],t,o=[]){let s=this.allocatePath;e.forEach((e=>{let n="RollingAggregation"==e.name?new x(e):new t(e);this.editor.register(n),this.engine.register(n),this.addComponentToTreeView(n.name,(async()=>{this.editor.addNode(await n.createNode())}),t!=E?s(n):[],o)}))},onTreeViewComponentClicked:function(e){e.onClick&&e.onClick()},allocatePath:function(e){return void 0===e.humanModule?["Other"]:e.humanModule.split(".")},onConnectionCreated:function(e){if("DataFrame"==e.output.node.className){let t=this.editor.nodes.find((e=>"DataFrame"==e.className)).data.X_columns,o=e.input.node;o.controls.get("X_columns")||o.addControl(new v(this.editor,"X_columns",o.data.X_columns,t,!1))}},onConnectionRemoved:function(e){if("DataFrame"==e.output.node.className){let t=e.input.node;t.controls.get("X_columns")&&(t.removeControl(t.controls.get("X_columns")),delete t.data.X_columns)}},onNodeClicked:function(e){this.selectedNode=null;let t=["y_columns","time_column","X_columns","timestamp","id"],o=["time_column","timestamp","id"];var s=this.findComponentSchema(e);if(this.editor.selected.contains(e)&&s){let n=JSON.parse(JSON.stringify(s.json_schema_form)),a=this.editor.nodes.find((e=>"DataFrame"==e.className));this.selectedNode={},this.selectedNode.name=e.name,this.selectedNode.node=e,this.selectedNode.doc=s.doc?s.doc:null,"DataFrame"!=e.className&&t.forEach((t=>{if(e.controls.get(t)){let s=[];a&&(s=a.data[o.includes(t)?"additional_columns":t]),function(e,t,o,s=!0){e[t]={type:s?"array":"string",title:t,enum:o,items:{type:"string",enum:o}},s?delete e[t].enum:delete e[t].items}(n.properties,t,s,!o.includes(t)),"y_columns"!=t||e.data.y_columns||(e.data.y_columns=[]),"X_columns"==t&&(this.selectedNode.order=["X_columns","*"],n.properties.X_columns["x-slots"]={after:"<hr class='v-divider mb-2' />"},e.data.X_columns||(e.data.X_columns=s)),o.includes(t)?e.data[t]=s.includes(e.data[t])?e.data[t]:null:e.data[t]=e.data[t].filter((e=>s.includes(e)))}})),this.selectedNode.schema=n}},onClosePanel:function(){this.editor.selected.list=[],this.selectedNode=null},nodeMouseDownEvent:function(e){this.nodeStartX=e.pageX,this.nodeStartY=e.pageY},nodeMouseUpEvent:function(e){const t=Math.abs(e.pageX-this.nodeStartX),o=Math.abs(e.pageY-this.nodeStartY);let s=e.target.closest(".node");t<6&&o<6&&this.onNodeClicked(this.editor.nodes.find((e=>e.id==s.id)))},editorBackgroundClickEvent:function(e){this.selectedNode&&(this.editor.selected.list=[],this.selectedNode=null)},nodeClickHandlers:function(){let e=document.getElementsByClassName("node"),t=document.querySelector(".rete-background");t.removeEventListener("click",this.editorBackgroundClickEvent),Array.from(e).forEach((e=>{e.removeEventListener("mousedown",this.nodeMouseDownEvent),e.removeEventListener("mouseup",this.nodeMouseUpEvent)})),t.addEventListener("click",this.editorBackgroundClickEvent),Array.from(e).forEach((e=>{e.addEventListener("mousedown",this.nodeMouseDownEvent),e.addEventListener("mouseup",this.nodeMouseUpEvent)}))}}},undefined,false,undefined,!1,void 0,void 0,void 0),U=function(e){U.installed||(U.installed=!0,e.component("NodeEditor",W))};W.install=U;export default W;
