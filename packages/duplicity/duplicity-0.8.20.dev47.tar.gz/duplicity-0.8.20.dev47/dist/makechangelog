#!/bin/bash

set -e

if [ "$#" -ne 0 ]; then
    echo "usage: makechangelog"
    exit 2
fi

gitchangelog > CHANGELOG.md
CNT=`git status --porcelain | tee | grep -v " M CHANGELOG.md" | wc -l`
if [ "$CNT" != "0" ]; then
    echo "r*** REPO DIRTY, REFUSING TO COMMIT ***"
    exit 1
fi

git commit -m"Update changelog." CHANGELOG.md
git push -o ci.skip
