(this["webpackJsonpmaubot-manager"]=this["webpackJsonpmaubot-manager"]||[]).push([[0],{143:function(e,t,s){"use strict";s.r(t);var a=s(1),n=s.n(a),i=s(23),r=s.n(i),c=(s(64),s(6)),o=s(7),l=s(0);var h=({component:e,render:t,authed:s,to:a="/login",...i})=>Object(l.jsx)(o.b,{...i,render:i=>!0===s?e?n.a.createElement(e,i):t():Object(l.jsx)(o.a,{to:{pathname:a}})});var d=e=>Object(l.jsx)("div",{...e,className:`spinner ${e.className||""}`,children:Object(l.jsx)("svg",{viewBox:"25 25 50 50",children:Object(l.jsx)("circle",{cx:"50",cy:"50",r:"20",fill:"none",strokeWidth:"2",strokeMiterlimit:"10"})})});let p="/_matrix/maubot/v1";function u(e="application/json"){return{"Content-Type":e,Authorization:`Bearer ${localStorage.accessToken}`}}async function j(e,t){const s=await fetch(`${p}/${e}/${t}`,{headers:u(),method:"DELETE"});return 204===s.status?{success:!0}:await s.json()}async function b(e,t,s,a){const n=await fetch(`${p}/${e}/${s||t.id}${a||""}`,{headers:u(),body:JSON.stringify(t),method:"PUT"});return await n.json()}async function g(e){const t=await fetch(`${p}${e}`,{headers:u()});return await t.json()}let m=null;const v=async()=>{m=await g("/features")};let O;var x,y={login:async function(e,t){const s=await fetch(`${p}/auth/login`,{method:"POST",body:JSON.stringify({username:e,password:t})});return await s.json()},ping:async function(){const e=await fetch(`${p}/auth/ping`,{method:"POST",headers:u()}),t=await e.json();if(t.username)return m=t.features,t.username;if("auth_token_missing"===t.errcode||"auth_token_invalid"===t.errcode)return m||await v(),null;throw t},setBasePath:function(e){p=e},getFeatures:()=>m,remoteGetFeatures:v,openLogSocket:async function(){const e=`${"https:"===window.location.protocol?"wss:":"ws:"}//${window.location.host}${p}/logs`,t={socket:null,connected:!1,authenticated:!1,onLog:e=>{},onHistory:e=>{},fails:-1},s=()=>{t.socket.send(localStorage.accessToken),t.connected=!0},a=e=>{const s=JSON.parse(e.data);void 0!==s.auth_success?s.auth_success?(console.info("Websocket connection authentication successful"),t.authenticated=!0,t.fails=-1):console.info("Websocket connection authentication failed"):s.history?t.onHistory(s.history):t.onLog(s)},n=i=>{i&&(4e3===i.code?console.error("Websocket connection failed: access token invalid or not provided"):1012===i.code&&console.info("Websocket connection closed: server is restarting")),t.connected=!1,t.socket=null,t.fails++;setTimeout((()=>{t.socket=new WebSocket(e),t.socket.onopen=s,t.socket.onmessage=a,t.socket.onclose=n}),Math.min(5*t.fails*1e3,3e4))};return n(),t},debugOpenFile:async function(e,t){const s=await fetch(`${p}/debug/open`,{headers:u(),body:JSON.stringify({path:e,line:t}),method:"POST"});return await s.json()},debugOpenFileEnabled:()=>O,updateDebugOpenFileEnabled:async()=>{const e=await g("/debug/open");O=e.enabled||!1},getInstances:()=>g("/instances"),getInstance:e=>g(`/instance/${e}`),putInstance:(e,t)=>b("instance",e,t),deleteInstance:e=>j("instance",e),getInstanceDatabase:e=>g(`/instance/${e}/database`),queryInstanceDatabase:async(e,t)=>{const s=await fetch(`${p}/instance/${e}/database/query`,{headers:u(),body:JSON.stringify({query:t}),method:"POST"});return await s.json()},getPlugins:()=>g("/plugins"),getPlugin:e=>g(`/plugin/${e}`),uploadPlugin:async function(e,t){let s;return s=t?await fetch(`${p}/plugin/${t}`,{headers:u("application/zip"),body:e,method:"PUT"}):await fetch(`${p}/plugins/upload`,{headers:u("application/zip"),body:e,method:"POST"}),await s.json()},deletePlugin:e=>j("plugin",e),getClients:()=>g("/clients"),getClient:e=>g(`/clients/${e}`),uploadAvatar:async function(e,t,s){const a=await fetch(`${p}/proxy/${e}/_matrix/media/r0/upload`,{headers:u(s),body:t,method:"POST"});return await a.json()},getAvatarURL:function({id:e,avatar_url:t}){return(t=t||"").startsWith("mxc://")&&(t=t.substr("mxc://".length)),`${p}/proxy/${e}/_matrix/media/r0/download/${t}?access_token=${localStorage.accessToken}`},putClient:e=>b("client",e),deleteClient:e=>j("client",e),clearClientCache:async function(e){const t=await fetch(`${p}/client/${e}/clearcache`,{headers:u(),method:"POST"});return await t.json()},getClientAuthServers:()=>g("/client/auth/servers"),doClientAuth:async function(e,t,s,a){const n=await fetch(`${p}/client/auth/${e}/${t}`,{headers:u(),body:JSON.stringify({username:s,password:a}),method:"POST"});return await n.json()}};function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function w({title:e,titleId:t,...s},n){return a.createElement("svg",f({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,x||(x=a.createElement("path",{fill:"#000000",d:"M17,13H13V17H11V13H7V11H11V7H13V11H17M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"})))}const N=a.forwardRef(w);s.p;var C,S,k=s(56),E=s.n(k);s(75),s(76);function L(){return(L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function $({title:e,titleId:t,...s},n){return a.createElement("svg",L({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,C||(C=a.createElement("path",{d:"M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"})),S||(S=a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"})))}const _=a.forwardRef($);var A;s.p;function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function F({title:e,titleId:t,...s},n){return a.createElement("svg",T({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,A||(A=a.createElement("path",{fill:"#000000",d:"M12,2A2,2 0 0,1 14,4C14,4.74 13.6,5.39 13,5.73V7H14A7,7 0 0,1 21,14H22A1,1 0 0,1 23,15V18A1,1 0 0,1 22,19H21V20A2,2 0 0,1 19,22H5A2,2 0 0,1 3,20V19H2A1,1 0 0,1 1,18V15A1,1 0 0,1 2,14H3A7,7 0 0,1 10,7H11V5.73C10.4,5.39 10,4.74 10,4A2,2 0 0,1 12,2M7.5,13A2.5,2.5 0 0,0 5,15.5A2.5,2.5 0 0,0 7.5,18A2.5,2.5 0 0,0 10,15.5A2.5,2.5 0 0,0 7.5,13M16.5,13A2.5,2.5 0 0,0 14,15.5A2.5,2.5 0 0,0 16.5,18A2.5,2.5 0 0,0 19,15.5A2.5,2.5 0 0,0 16.5,13Z"})))}const I=a.forwardRef(F);s.p;var P=s(58),D=s(57);class M extends a.Component{constructor(e){super(e),this.toggle=()=>{this.props.onToggle?this.props.onToggle(!this.state.active):this.setState({active:!this.state.active})},this.toggleKeyboard=e=>(" "===e.key||"Enter"===e.key)&&this.toggle(),this.state={active:e.active}}componentDidUpdate(e){e.active!==this.props.active&&this.setState({active:this.props.active})}render(){return Object(l.jsx)("div",{className:"switch","data-active":this.state.active,onClick:this.toggle,tabIndex:"0",onKeyPress:this.toggleKeyboard,id:this.props.id,children:Object(l.jsx)("div",{className:"box",children:Object(l.jsxs)("span",{className:"text",children:[Object(l.jsx)("span",{className:"on",children:this.props.onText||"On"}),Object(l.jsx)("span",{className:"off",children:this.props.offText||"Off"})]})})})}}var R=M;const B=({children:e,wrapperClass:t})=>t?Object(l.jsx)("div",{className:t,children:Object(l.jsx)("div",{className:"preference-table",children:e})}):Object(l.jsx)("div",{className:"preference-table",children:e}),V=({name:e,fullWidth:t=!1,labelFor:s,changed:a=!1,children:n})=>Object(l.jsxs)("div",{className:`entry ${t?"full-width":""} ${a?"changed":""}`,children:[Object(l.jsx)("label",{htmlFor:s,children:e}),Object(l.jsx)("div",{className:"value",children:n})]}),H=({rowName:e,value:t,origValue:s,fullWidth:a=!1,...n})=>Object(l.jsx)(V,{name:e,fullWidth:a,labelFor:e,changed:void 0!==s&&t!==s,children:Object(l.jsx)("input",{...n,value:t,id:e})}),U=({rowName:e,active:t,origActive:s,fullWidth:a=!1,...n})=>Object(l.jsx)(V,{name:e,fullWidth:a,labelFor:e,changed:void 0!==s&&t!==s,children:Object(l.jsx)(R,{...n,active:t,id:e})}),W=({rowName:e,value:t,origValue:s,fullWidth:a=!1,creatable:n=!1,...i})=>Object(l.jsx)(V,{name:e,fullWidth:a,labelFor:e,changed:void 0!==s&&t.id!==s,children:n?Object(l.jsx)(D.a,{className:"select",...i,id:e,value:t}):Object(l.jsx)(P.a,{className:"select",...i,id:e,value:t})});var q=B;class z extends a.Component{constructor(e){super(e),this.delete=async()=>{if(!window.confirm(`Are you sure you want to delete ${this.state.id}?`))return;this.setState({deleting:!0});const e=await this.deleteFunc(this.state.id);e.success?(this.props.history.push("/"),this.props.onDelete()):this.setState({deleting:!1,error:e.error})},this.inputChange=e=>{e.target.name&&this.setState({[e.target.name]:e.target.value})},this.renderInstances=()=>!this.isNew&&Object(l.jsxs)("div",{className:"instances",children:[Object(l.jsx)("h3",{children:this.hasInstances?"Instances":"No instances :("}),this.state.instances.map((e=>Object(l.jsx)(c.b,{className:"instance",to:`/instance/${e.id}`,children:e.id},e.id)))]}),this.renderLogButton=e=>!this.isNew&&y.getFeatures().log&&Object(l.jsx)("div",{className:"buttons",children:Object(l.jsx)("button",{className:"open-log",onClick:()=>this.props.openLog(e),children:"View logs"})}),this.state=Object.assign(this.initialState,e.entry)}UNSAFE_componentWillReceiveProps(e){const t=Object.assign(this.initialState,e.entry);for(const s of this.entryKeys)this.props.entry[s]===e.entry[s]&&(t[s]=this.state[s]);this.setState(t)}get entryKeys(){return[]}get initialState(){return{}}get hasInstances(){return this.state.instances&&this.state.instances.length>0}get isNew(){return!this.props.entry.id}async readFile(e){return new Promise(((t,s)=>{const a=new FileReader;a.readAsArrayBuffer(e),a.onload=e=>t(e.target.result),a.onerror=e=>s(e)}))}}var Q,K,X=z,J=s(31);function G(){return(G=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function Z({title:e,titleId:t,...s},n){return a.createElement("svg",G({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,Q||(Q=a.createElement("path",{d:"M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"})),K||(K=a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"})))}const Y=a.forwardRef(Z);var ee,te;s.p;function se(){return(se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function ae({title:e,titleId:t,...s},n){return a.createElement("svg",se({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,ee||(ee=a.createElement("path",{d:"M7 10l5 5 5-5z"})),te||(te=a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"})))}const ne=a.forwardRef(ae);var ie,re;s.p;function ce(){return(ce=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function oe({title:e,titleId:t,...s},n){return a.createElement("svg",ce({xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,ie||(ie=a.createElement("path",{d:"M7 14l5-5 5 5z"})),re||(re=a.createElement("path",{d:"M0 0h24v24H0z",fill:"none"})))}const le=a.forwardRef(oe);s.p;Map.prototype.map=function(e){const t=[];for(const[s,a]of this)t.push(e(a,s,this));return t};class he extends a.Component{constructor(e){super(e),this.reloadContent=async(e=!0)=>{this.setState({loading:!0});const t=await y.queryInstanceDatabase(this.props.instanceID,this.state.query);this.setState({loading:!1}),e&&this.setState({prevQuery:null,rowCount:null,insertedPrimaryKey:null,error:null}),t.ok?t.rows?this.setState({header:t.columns,content:t.rows}):(this.setState({prevQuery:t.query,rowCount:t.rowcount,insertedPrimaryKey:t.insertedPrimaryKey}),this.buildSQLQuery(this.state.selectedTable,!1)):this.setState({error:t.error})},this.deleteRow=async(e,t)=>{const s=this.state.content[t.row],a=this.state.header,n=[];for(const[c,o]of Object.entries(a)){const e=s[c];n.push(`${o}='${this.sqlEscape(e.toString())}'`)}const i=`DELETE FROM "${this.state.selectedTable}" WHERE ${n.join(" AND ")}`,r=await y.queryInstanceDatabase(this.props.instanceID,i);this.setState({prevQuery:`DELETE FROM "${this.state.selectedTable}" ...`,rowCount:r.rowcount}),await this.reloadContent(!1)},this.editCell=async(e,t)=>{console.log("Edit",t)},this.collectContextMeta=e=>({row:e.row,col:e.col}),this.sqlEscape=e=>e.replace(/[\0\x08\x09\x1a\n\r"'\\%]/g,(e=>{switch(e){case"\0":return"\\0";case"\b":return"\\b";case"\t":return"\\t";case"\x1a":return"\\z";case"\n":return"\\n";case"\r":return"\\r";case'"':case"'":case"\\":case"%":return"\\"+e;default:return e}})),this.renderTable=()=>Object(l.jsx)("div",{className:"table",children:this.state.header?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("table",{children:[Object(l.jsx)("thead",{children:Object(l.jsx)("tr",{children:this.state.header.map((e=>Object(l.jsx)("td",{children:Object(l.jsxs)("span",{onClick:()=>this.toggleSort(e),title:this.getColumnType(e),children:[Object(l.jsx)("strong",{children:e}),this.getColumnInfo(e),this.getSortIcon(e)]})},e)))})}),Object(l.jsx)("tbody",{children:this.state.content.map(((e,t)=>Object(l.jsx)("tr",{children:e.map(((e,s)=>Object(l.jsx)(J.b,{id:"database_table_menu",renderTag:"td",row:t,col:s,collect:this.collectContextMeta,children:e},s)))},t)))})]}),Object(l.jsxs)(J.a,{id:"database_table_menu",children:[Object(l.jsx)(J.c,{onClick:this.deleteRow,children:"Delete row"}),Object(l.jsx)(J.c,{disabled:!0,onClick:this.editCell,children:"Edit cell"})]})]}):this.state.loading?Object(l.jsx)(d,{}):null}),this.state={tables:null,header:null,content:null,query:"",selectedTable:null,error:null,prevQuery:null,rowCount:null,insertedPrimaryKey:null},this.order=new Map}async componentDidMount(){const e=new Map(Object.entries(await y.getInstanceDatabase(this.props.instanceID)));for(const[t,s]of e){s.name=t,s.columns=new Map(Object.entries(s.columns));for(const[e,t]of s.columns)t.name=e,t.sort=null}this.setState({tables:e}),this.checkLocationTable()}componentDidUpdate(e){this.props.location!==e.location&&(this.order=new Map,this.setState({header:null,content:null}),this.checkLocationTable())}checkLocationTable(){const e=`/instance/${this.props.instanceID}/database/`;if(this.props.location.pathname.startsWith(e)){const t=this.props.location.pathname.substr(e.length);this.setState({selectedTable:t}),this.buildSQLQuery(t)}}getSortQueryParams(e){const t=[];for(const[s,a]of Array.from(this.order.entries()).reverse())t.push(`order=${s}:${a}`);return t}buildSQLQuery(e=this.state.selectedTable,t=!0){let s=`SELECT * FROM "${e}"`;if(this.order.size>0){s+=` ORDER BY ${Array.from(this.order.entries()).reverse().map((([e,t])=>`${e} ${t}`)).join(", ")}`}s+=" LIMIT 100",this.setState({query:s},(()=>this.reloadContent(t)))}toggleSort(e){const t=this.order.get(e)||"auto";switch(this.order.delete(e),t){case"auto":this.order.set(e,"DESC");break;case"DESC":this.order.set(e,"ASC")}this.buildSQLQuery()}getSortIcon(e){switch(this.order.get(e)){case"DESC":return Object(l.jsx)(ne,{});case"ASC":return Object(l.jsx)(le,{});default:return null}}getColumnInfo(e){const t=this.state.tables.get(this.state.selectedTable);if(!t)return null;const s=t.columns.get(e);return s?s.primary?Object(l.jsx)("span",{className:"meta",children:"\xa0(pk)"}):s.unique?Object(l.jsx)("span",{className:"meta",children:"\xa0(u)"}):null:null}getColumnType(e){const t=this.state.tables.get(this.state.selectedTable);if(!t)return null;const s=t.columns.get(e);return s?s.type:null}renderContent(){return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"tables",children:this.state.tables.map(((e,t)=>Object(l.jsx)(c.c,{to:`/instance/${this.props.instanceID}/database/${t}`,children:t},t)))}),Object(l.jsxs)("div",{className:"query",children:[Object(l.jsx)("input",{type:"text",value:this.state.query,name:"query",onChange:e=>this.setState({query:e.target.value})}),Object(l.jsx)("button",{type:"submit",onClick:this.reloadContent,children:"Query"})]}),this.state.error&&Object(l.jsx)("div",{className:"error",children:this.state.error}),this.state.prevQuery&&Object(l.jsxs)("div",{className:"prev-query",children:[Object(l.jsxs)("p",{children:["Executed ",Object(l.jsx)("span",{className:"query",children:this.state.prevQuery})," - affected ",Object(l.jsxs)("strong",{children:[this.state.rowCount," rows"]}),"."]}),this.state.insertedPrimaryKey&&Object(l.jsxs)("p",{className:"inserted-primary-key",children:["Inserted primary key: ",this.state.insertedPrimaryKey]})]}),this.renderTable()]})}render(){return Object(l.jsxs)("div",{className:"instance-database",children:[Object(l.jsx)("div",{className:"topbar",children:Object(l.jsxs)(c.b,{className:"topbar",to:`/instance/${this.props.instanceID}`,children:[Object(l.jsx)(Y,{}),"Back"]})}),this.state.tables?this.renderContent():Object(l.jsx)(d,{className:"maubot-loading"})]})}}var de=Object(o.g)(he);class pe extends X{constructor(e){super(e),this.clientSelectEntry=e=>e&&{id:e.id,value:e.id,label:Object(l.jsxs)("div",{className:"select-client",children:[this.getAvatarMXC(e)?Object(l.jsx)("img",{className:"avatar",src:this.getAvatarURL(e),alt:""}):Object(l.jsx)(I,{className:"avatar"}),Object(l.jsx)("span",{className:"displayname",children:("disable"===e.displayname?e.remote_displayname:e.displayname)||e.id})]})},this.save=async()=>{this.setState({saving:!0});const e=await y.putInstance(this.instanceInState,this.props.entry?this.props.entry.id:void 0);e.id?(this.isNew?this.props.history.push(`/instance/${e.id}`):(e.id!==this.props.entry.id&&this.props.history.replace(`/instance/${e.id}`),this.setState({saving:!1,error:""})),this.props.onChange(e)):this.setState({saving:!1,error:e.error})},this.renderDatabase=()=>Object(l.jsx)(de,{instanceID:this.props.entry.id}),this.renderMain=()=>Object(l.jsxs)("div",{className:"instance",children:[Object(l.jsxs)(q,{children:[Object(l.jsx)(H,{rowName:"ID",type:"text",name:"id",value:this.state.id,placeholder:"fancybotinstance",onChange:this.inputChange,disabled:!this.isNew,fullWidth:!0,className:"id"}),Object(l.jsx)(U,{rowName:"Enabled",active:this.state.enabled,origActive:this.props.entry.enabled,onToggle:e=>this.setState({enabled:e})}),Object(l.jsx)(U,{rowName:"Running",active:this.state.started,origActive:this.props.entry.started,onToggle:e=>this.setState({started:e})}),y.getFeatures().client?Object(l.jsx)(W,{rowName:"Primary user",options:this.clientOptions,isSearchable:!1,value:this.selectedClientEntry,origValue:this.props.entry.primary_user,onChange:({id:e})=>this.setState({primary_user:e})}):Object(l.jsx)(H,{rowName:"Primary user",type:"text",name:"primary_user",value:this.state.primary_user,placeholder:"@user:example.com",onChange:this.inputChange}),y.getFeatures().plugin?Object(l.jsx)(W,{rowName:"Type",options:this.typeOptions,isSearchable:!1,value:this.selectedPluginEntry,origValue:this.props.entry.type,onChange:({id:e})=>this.setState({type:e})}):Object(l.jsx)(H,{rowName:"Type",type:"text",name:"type",value:this.state.type,placeholder:"xyz.maubot.example",onChange:this.inputChange})]}),!this.isNew&&Boolean(this.props.entry.base_config)&&Object(l.jsx)(E.a,{mode:"yaml",theme:"github",onChange:e=>this.setState({config:e}),name:"config",value:this.state.config,editorProps:{fontSize:"10pt",$blockScrolling:!0}}),Object(l.jsxs)("div",{className:"buttons",children:[!this.isNew&&Object(l.jsx)("button",{className:"delete",onClick:this.delete,disabled:this.loading,children:this.state.deleting?Object(l.jsx)(d,{}):"Delete"}),Object(l.jsx)("button",{className:"save "+(this.isValid?"":"disabled-bg"),onClick:this.save,disabled:this.loading||!this.isValid,children:this.state.saving?Object(l.jsx)(d,{}):this.isNew?"Create":"Save"})]}),!this.isNew&&Object(l.jsxs)("div",{className:"buttons",children:[this.props.entry.database&&Object(l.jsx)(c.b,{className:"button open-database",to:`/instance/${this.state.id}/database`,children:"View database"}),y.getFeatures().log&&Object(l.jsx)("button",{className:"open-log",onClick:()=>this.props.openLog(`instance.${this.state.id}`),children:"View logs"})]}),Object(l.jsx)("div",{className:"error",children:this.state.error})]}),this.deleteFunc=y.deleteInstance,this.updateClientOptions()}get entryKeys(){return["id","primary_user","enabled","started","type","config"]}get initialState(){return{id:"",primary_user:"",enabled:!0,started:!0,type:"",config:"",saving:!1,deleting:!1,error:""}}get instanceInState(){const e=Object.assign({},this.state);return delete e.saving,delete e.deleting,delete e.error,e}componentDidUpdate(e){this.updateClientOptions()}getAvatarMXC(e){return"disable"===e.avatar_url?e.remote_avatar_url:e.avatar_url}getAvatarURL(e){return y.getAvatarURL({id:e.id,avatar_url:this.getAvatarMXC(e)})}updateClientOptions(){this.clientOptions=Object.values(this.props.ctx.clients).map(this.clientSelectEntry)}get selectedClientEntry(){return this.state.primary_user?this.clientSelectEntry(this.props.ctx.clients[this.state.primary_user]):{}}get selectedPluginEntry(){return{id:this.state.type,value:this.state.type,label:this.state.type}}get typeOptions(){return Object.values(this.props.ctx.plugins).map((e=>e&&{id:e.id,value:e.id,label:e.id}))}get loading(){return this.state.deleting||this.state.saving}get isValid(){return this.state.id&&this.state.primary_user&&this.state.type}render(){return Object(l.jsxs)(o.d,{children:[Object(l.jsx)(o.b,{path:"/instance/:id/database",render:this.renderDatabase}),Object(l.jsx)(o.b,{render:this.renderMain})]})}}pe.ListEntry=({entry:e})=>Object(l.jsxs)(c.c,{className:"instance entry",to:`/instance/${e.id}`,children:[Object(l.jsx)("span",{className:"id",children:e.id}),Object(l.jsx)(_,{className:"chevron"})]});var ue,je=Object(o.g)(pe);function be(){return(be=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function ge({title:e,titleId:t,...s},n){return a.createElement("svg",be({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:24,height:24,viewBox:"0 0 24 24",ref:n,"aria-labelledby":t},s),e?a.createElement("title",{id:t},e):null,ue||(ue=a.createElement("path",{fill:"#000000",d:"M9,16V10H5L12,3L19,10H15V16H9M5,20V18H19V20H5Z"})))}const me=a.forwardRef(ge);s.p;class ve extends X{constructor(e){super(e),this.homeserverEntry=([e,t])=>t&&{id:t,value:t,label:e||t},this.avatarUpload=async e=>{const t=e.target.files[0];this.setState({uploadingAvatar:!0});const s=await this.readFile(t),a=await y.uploadAvatar(this.state.id,s,t.type);this.setState({uploadingAvatar:!1,avatar_url:a.content_uri})},this.save=async()=>{this.setState({saving:!0});const e=await y.putClient(this.clientInState);e.id?(this.isNew?this.props.history.push(`/client/${e.id}`):this.setState({saving:!1,error:""}),this.props.onChange(e)):this.setState({saving:!1,error:e.error})},this.startOrStop=async()=>{this.setState({startingOrStopping:!0});const e=await y.putClient({id:this.props.entry.id,started:!this.props.entry.started});e.id?(this.props.onChange(e),this.setState({startingOrStopping:!1,error:""})):this.setState({startingOrStopping:!1,error:e.error})},this.clearCache=async()=>{this.setState({clearingCache:!0});const e=await y.clearClientCache(this.props.entry.id);e.success?this.setState({clearingCache:!1,error:""}):this.setState({clearingCache:!1,error:e.error})},this.renderStartedContainer=()=>{let e;return e=this.props.entry.started?this.props.entry.sync_ok?"Started":"Erroring":this.props.entry.enabled?"Stopped":"Disabled",Object(l.jsxs)("div",{className:"started-container",children:[Object(l.jsx)("span",{className:`started ${this.props.entry.started}\n                             ${this.props.entry.sync_ok?"sync_ok":"sync_error"}\n                             ${this.props.entry.enabled?"":"disabled"}`}),Object(l.jsx)("span",{className:"text",children:e})]})},this.renderSidebar=()=>!this.isNew&&Object(l.jsxs)("div",{className:"sidebar",children:[Object(l.jsxs)("div",{className:`avatar-container ${this.avatarMXC?"":"no-avatar"}\n                        ${this.state.uploadingAvatar?"uploading":""}`,children:[this.avatarMXC&&Object(l.jsx)("img",{className:"avatar",src:this.avatarURL,alt:"Avatar"}),Object(l.jsx)(me,{className:"upload"}),Object(l.jsx)("input",{className:"file-selector",type:"file",accept:"image/png, image/jpeg",onChange:this.avatarUpload,disabled:this.state.uploadingAvatar,onDragEnter:e=>e.target.parentElement.classList.add("drag"),onDragLeave:e=>e.target.parentElement.classList.remove("drag")}),this.state.uploadingAvatar&&Object(l.jsx)(d,{})]}),this.renderStartedContainer(),(this.props.entry.started||this.props.entry.enabled)&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("button",{className:"save",onClick:this.startOrStop,disabled:this.loading,children:this.state.startingOrStopping?Object(l.jsx)(d,{}):this.props.entry.started?"Stop":"Start"}),Object(l.jsx)("button",{className:"clearcache",onClick:this.clearCache,disabled:this.loading,children:this.state.clearingCache?Object(l.jsx)(d,{}):"Clear cache"})]})]}),this.renderPreferences=()=>Object(l.jsxs)(B,{children:[Object(l.jsx)(H,{rowName:"User ID",type:"text",disabled:!this.isNew,fullWidth:!0,name:this.isNew?"id":"",className:"id",value:this.state.id,origValue:this.props.entry.id,placeholder:"@fancybot:example.com",onChange:this.inputChange}),y.getFeatures().client_auth?Object(l.jsx)(W,{rowName:"Homeserver",options:this.homeserverOptions,isSearchable:!0,value:this.selectedHomeserver,origValue:this.props.entry.homeserver,onChange:({value:e})=>this.setState({homeserver:e}),creatable:!0,isValidNewOption:this.isValidHomeserver}):Object(l.jsx)(H,{rowName:"Homeserver",type:"text",name:"homeserver",value:this.state.homeserver,origValue:this.props.entry.homeserver,placeholder:"https://example.com",onChange:this.inputChange}),Object(l.jsx)(H,{rowName:"Access token",type:"text",name:"access_token",value:this.state.access_token,origValue:this.props.entry.access_token,placeholder:"MDAxYWxvY2F0aW9uIG1hdHJpeC5sb2NhbAowMDEzaWRlbnRpZmllc",onChange:this.inputChange}),Object(l.jsx)(H,{rowName:"Display name",type:"text",name:"displayname",value:this.state.displayname,origValue:this.props.entry.displayname,placeholder:"My fancy bot",onChange:this.inputChange}),Object(l.jsx)(H,{rowName:"Avatar URL",type:"text",name:"avatar_url",value:this.state.avatar_url,origValue:this.props.entry.avatar_url,placeholder:"mxc://example.com/mbmwyoTvPhEQPiCskcUsppko",onChange:this.inputChange}),Object(l.jsx)(U,{rowName:"Sync",active:this.state.sync,origActive:this.props.entry.sync,onToggle:e=>this.setState({sync:e})}),Object(l.jsx)(U,{rowName:"Autojoin",active:this.state.autojoin,origActive:this.props.entry.autojoin,onToggle:e=>this.setState({autojoin:e})}),Object(l.jsx)(U,{rowName:"Enabled",active:this.state.enabled,origActive:this.props.entry.enabled,onToggle:e=>this.setState({enabled:e,started:e&&this.state.started})}),Object(l.jsx)(U,{rowName:"Online",active:this.state.online,origActive:this.props.entry.online,onToggle:e=>this.setState({online:e})})]}),this.renderPrefButtons=()=>Object(l.jsxs)(l.Fragment,{children:[Object(l.jsxs)("div",{className:"buttons",children:[!this.isNew&&Object(l.jsx)("button",{className:"delete "+(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete client that is in use":"",children:this.state.deleting?Object(l.jsx)(d,{}):"Delete"}),Object(l.jsx)("button",{className:"save",onClick:this.save,disabled:this.loading,children:this.state.saving?Object(l.jsx)(d,{}):this.isNew?"Create":"Save"})]}),this.renderLogButton(this.state.id),Object(l.jsx)("div",{className:"error",children:this.state.error})]}),this.deleteFunc=y.deleteClient,this.homeserverOptions={}}get entryKeys(){return["id","displayname","homeserver","avatar_url","access_token","sync","autojoin","online","enabled","started"]}get initialState(){return{id:"",displayname:"",homeserver:"",avatar_url:"",access_token:"",sync:!0,autojoin:!0,enabled:!0,online:!0,started:!1,instances:[],uploadingAvatar:!1,saving:!1,deleting:!1,startingOrStopping:!1,clearingCache:!1,error:""}}get clientInState(){const e=Object.assign({},this.state);return delete e.uploadingAvatar,delete e.saving,delete e.deleting,delete e.startingOrStopping,delete e.clearingCache,delete e.error,delete e.instances,e}get selectedHomeserver(){return this.state.homeserver?this.homeserverEntry([this.props.ctx.homeserversByURL[this.state.homeserver],this.state.homeserver]):{}}componentDidUpdate(e){this.updateHomeserverOptions()}updateHomeserverOptions(){this.homeserverOptions=Object.entries(this.props.ctx.homeserversByName).map(this.homeserverEntry)}isValidHomeserver(e){try{return Boolean(new URL(e))}catch(t){return!1}}get loading(){return this.state.saving||this.state.startingOrStopping||this.clearingCache||this.state.deleting}get avatarMXC(){return"disable"===this.state.avatar_url?this.props.entry.remote_avatar_url:this.state.avatar_url}get avatarURL(){return y.getAvatarURL({id:this.state.id,avatar_url:this.avatarMXC})}render(){return Object(l.jsx)(l.Fragment,{children:Object(l.jsxs)("div",{className:"client",children:[this.renderSidebar(),Object(l.jsxs)("div",{className:"info",children:[this.renderPreferences(),this.renderPrefButtons(),this.renderInstances()]})]})})}}ve.ListEntry=({entry:e})=>{const t=["client","entry"];e.enabled?e.started||t.push("stopped"):t.push("disabled");const s="disable"===e.avatar_url?e.remote_avatar_url:e.avatar_url,a=s&&y.getAvatarURL({id:e.id,avatar_url:s}),n=("disable"===e.displayname?e.remote_displayname:e.displayname)||e.id;return Object(l.jsxs)(c.c,{className:t.join(" "),to:`/client/${e.id}`,children:[a?Object(l.jsx)("img",{className:"avatar",src:a,alt:""}):Object(l.jsx)(I,{className:"avatar"}),Object(l.jsx)("span",{className:"displayname",children:n}),Object(l.jsx)(_,{className:"chevron"})]})};var Oe=Object(o.g)(ve);class xe extends X{constructor(e){super(e),this.upload=async e=>{const t=e.target.files[0];this.setState({uploadingAvatar:!0});const s=await this.readFile(t),a=await y.uploadPlugin(s,this.state.id);a.id?(this.isNew?this.props.history.push(`/plugin/${a.id}`):this.setState({saving:!1,error:""}),this.props.onChange(a)):this.setState({saving:!1,error:a.error})},this.deleteFunc=y.deletePlugin}get initialState(){return{id:"",version:"",instances:[],uploading:!1,deleting:!1,error:""}}render(){return Object(l.jsxs)("div",{className:"plugin",children:[!this.isNew&&Object(l.jsxs)(q,{children:[Object(l.jsx)(H,{rowName:"ID",type:"text",value:this.state.id,disabled:!0,className:"id"}),Object(l.jsx)(H,{rowName:"Version",type:"text",value:this.state.version,disabled:!0})]}),y.getFeatures().plugin_upload&&Object(l.jsxs)("div",{className:"upload-box "+(this.state.uploading?"uploading":""),children:[Object(l.jsx)(me,{className:"upload"}),Object(l.jsx)("input",{className:"file-selector",type:"file",accept:"application/zip+mbp",onChange:this.upload,disabled:this.state.uploading||this.state.deleting,onDragEnter:e=>e.target.parentElement.classList.add("drag"),onDragLeave:e=>e.target.parentElement.classList.remove("drag")}),this.state.uploading&&Object(l.jsx)(d,{})]}),!this.isNew&&Object(l.jsx)("div",{className:"buttons",children:Object(l.jsx)("button",{className:"delete "+(this.hasInstances?"disabled-bg":""),onClick:this.delete,disabled:this.loading||this.hasInstances,title:this.hasInstances?"Can't delete plugin that is in use":"",children:this.state.deleting?Object(l.jsx)(d,{}):"Delete"})}),this.renderLogButton("loader.zip"),Object(l.jsx)("div",{className:"error",children:this.state.error}),this.renderInstances()]})}}xe.ListEntry=({entry:e})=>Object(l.jsxs)(c.c,{className:"plugin entry",to:`/plugin/${e.id}`,children:[Object(l.jsx)("span",{className:"id",children:e.id}),Object(l.jsx)(_,{className:"chevron"})]});var ye=Object(o.g)(xe);class fe extends a.Component{render(){return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"home",children:"See sidebar to get started"}),Object(l.jsx)("div",{className:"buttons"})]})}}var we=fe,Ne=s(59),Ce=s.n(Ne);class Se extends a.Component{constructor(e){super(e),this.open=()=>this.setState({open:!0}),this.close=()=>this.setState({open:!1}),this.isOpen=()=>this.state.open,this.state={open:!1},this.wrapper={clientWidth:9001}}render(){return this.state.open&&Object(l.jsx)("div",{className:"modal-wrapper-wrapper",ref:e=>this.wrapper=e,onClick:()=>this.wrapper.clientWidth>720&&this.close(),children:Object(l.jsxs)("div",{className:"modal-wrapper",onClick:e=>e.stopPropagation(),children:[Object(l.jsx)("button",{className:"close",onClick:this.close,children:"Close"}),Object(l.jsx)("div",{className:"modal",children:Object(l.jsx)(Se.Context.Provider,{value:this,children:this.props.children})})]})})}}Se.Context=Object(a.createContext)(null);var ke=Se;class Ee extends a.PureComponent{renderName(){const e=this.props.line;if(e.nameLink){const t=this.context;return Object(l.jsx)(c.b,{to:e.nameLink,onClick:t.close,children:e.name})}return e.name}renderContent(){if(this.props.line.matrix_http_request){const e=this.props.line.matrix_http_request;return Object(l.jsxs)(l.Fragment,{children:[e.method," ",e.path,Object(l.jsx)("div",{className:"content",children:Object.entries(e.content||{}).length>0&&Object(l.jsx)(Ce.a,{data:{content:e.content},hideRoot:!0})})]})}return this.props.line.msg}onClickOpen(e,t){return()=>(y.debugOpenFileEnabled()&&y.debugOpenFile(e,t),!1)}renderTimeTitle(){return this.props.line.time.toDateString()}renderTime(){return Object(l.jsx)("a",{className:"time",title:this.renderTimeTitle(),href:`file:///${this.props.line.pathname}:${this.props.line.lineno}`,onClick:this.onClickOpen(this.props.line.pathname,this.props.line.lineno),children:this.props.line.time.toLocaleTimeString("en-GB")})}renderLevelName(){return Object(l.jsx)("span",{className:"level",children:this.props.line.levelname})}get unfocused(){return this.props.focus&&this.props.line.name!==this.props.focus?"unfocused":""}renderRow(e){return Object(l.jsxs)("div",{className:`row ${this.props.line.levelname.toLowerCase()} ${this.unfocused}`,children:[this.renderTime(),this.renderLevelName(),Object(l.jsx)("span",{className:"logger",children:this.renderName()}),Object(l.jsx)("span",{className:"text",children:e})]})}renderExceptionInfo(){if(!y.debugOpenFileEnabled())return this.props.line.exc_info;const e=[];let t=this.props.line.exc_info.replace(/File "(.+)", line ([0-9]+), in (.+)/g,((t,s,a,n)=>(e.push(Object(l.jsxs)("a",{href:`file:///${s}:${a}`,onClick:this.onClickOpen(s,a),children:['File "',s,'", line ',a,", in ",n]})),"||EDGE||")));e.reverse();const s=[];let a=0;for(const i of t.split("||EDGE||"))s.push(Object(l.jsxs)(n.a.Fragment,{children:[i,e.pop()]},a++));return s}render(){return Object(l.jsxs)(l.Fragment,{children:[this.renderRow(this.renderContent()),this.props.line.exc_info&&this.renderRow(this.renderExceptionInfo())]})}}Ee.contextType=ke.Context;class Le extends a.PureComponent{constructor(e){super(e),this.linesRef=n.a.createRef(),this.linesBottomRef=n.a.createRef()}getSnapshotBeforeUpdate(){return!(!this.linesRef.current||!this.linesBottomRef.current)&&Le.isVisible(this.linesRef.current,this.linesBottomRef.current)}componentDidUpdate(e,t,s){s&&Le.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}componentDidMount(){this.linesRef.current&&this.linesBottomRef.current&&Le.scrollParentToChild(this.linesRef.current,this.linesBottomRef.current)}static scrollParentToChild(e,t){const s=e.getBoundingClientRect(),a=t.getBoundingClientRect();Le.isVisible(e,t)||e.scrollBy({top:a.top+e.scrollTop-s.top})}static isVisible(e,t){const s=e.getBoundingClientRect(),a=t.getBoundingClientRect();return a.top>=s.top&&a.top<=s.top+e.clientHeight}render(){return Object(l.jsxs)("div",{className:"log",ref:this.linesRef,children:[Object(l.jsx)("div",{className:"lines",children:this.props.lines.map((e=>Object(l.jsx)(Ee,{line:e,focus:this.props.focus},e.id)))}),Object(l.jsx)("div",{ref:this.linesBottomRef})]})}}var $e=Le;class _e extends a.Component{constructor(e){super(e),this.openLog=e=>{this.setState({logFocus:"string"===typeof e?e:null}),this.logModal.open()},this.renderNotFound=(e="path")=>Object(l.jsxs)("div",{className:"not-found",children:["Oops! I'm afraid that ",e," couldn't be found."]}),this.renderDisabled=(e="path")=>Object(l.jsxs)("div",{className:"not-found",children:["The ",e," API has been disabled in the maubot config."]}),this.state={instances:{},clients:{},plugins:{},homeserversByName:{},homeserversByURL:{},sidebarOpen:!1,modalOpen:!1,logFocus:null,logLines:[]},this.logModal={open:()=>{},isOpen:()=>!1},window.maubot=this}componentDidUpdate(e){this.props.location!==e.location&&this.setState({sidebarOpen:!1})}async componentDidMount(){const[e,t,s,a]=await Promise.all([y.getInstances(),y.getClients(),y.getPlugins(),y.getClientAuthServers(),y.updateDebugOpenFileEnabled()]),n={};if(y.getFeatures().instance)for(const l of e)n[l.id]=l;const i={};if(y.getFeatures().client)for(const l of t)i[l.id]=l;const r={};if(y.getFeatures().plugin)for(const l of s)r[l.id]=l;const c=a,o={};if(y.getFeatures().client_auth)for(const[l,h]of Object.entries(a))o[h]=l;this.setState({instances:n,clients:i,plugins:r,homeserversByName:c,homeserversByURL:o}),await this.enableLogs()}async enableLogs(){if(!y.getFeatures().log)return;const e=await y.openLogSocket(),t=e=>{e.time=new Date(e.time),e.name.startsWith("maubot.")&&(e.name=e.name.substr("maubot.".length)),e.name.startsWith("client.")?(e.name=e.name.substr("client.".length),e.nameLink=`/client/${e.name}`):e.name.startsWith("instance.")&&(e.nameLink=`/instance/${e.name.substr("instance.".length)}`)};e.onHistory=e=>{for(const s of e)t(s);this.setState({logLines:e})},e.onLog=e=>{t(e),this.setState({logLines:this.state.logLines.concat(e)})}}renderList(e,t){return this.state[e]&&Object.values(this.state[e]).map((e=>n.a.createElement(t,{key:e.id,entry:e})))}delete(e,t){const s=Object.assign({},this.state[e]);delete s[t],this.setState({[e]:s})}add(e,t,s){const a=Object.assign({},this.state[e]);s&&s!==t.id&&delete a[s],a[t.id]=t,this.setState({[e]:a})}renderView(e,t,s){const a=e.slice(0,-1);if(!y.getFeatures()[a])return this.renderDisabled(a);const i=this.state[e][s];return i?n.a.createElement(t,{entry:i,onDelete:()=>this.delete(e,s),onChange:t=>this.add(e,t,s),openLog:this.openLog,ctx:this.state}):this.renderNotFound(a)}renderMain(){return Object(l.jsxs)("div",{className:"dashboard "+(this.state.sidebarOpen?"sidebar-open":""),children:[Object(l.jsxs)(c.b,{to:"/",className:"title",children:[Object(l.jsx)("img",{src:"favicon.png",alt:""}),"Maubot Manager"]}),Object(l.jsx)("div",{className:"user",children:Object(l.jsx)("span",{children:localStorage.username})}),Object(l.jsxs)("nav",{className:"sidebar",children:[Object(l.jsx)("div",{className:"buttons",children:y.getFeatures().log&&Object(l.jsx)("button",{className:"open-log",onClick:this.openLog,children:Object(l.jsx)("span",{children:"View logs"})})}),y.getFeatures().instance&&Object(l.jsxs)("div",{className:"instances list",children:[Object(l.jsxs)("div",{className:"title",children:[Object(l.jsx)("h2",{children:"Instances"}),Object(l.jsx)(c.b,{to:"/new/instance",children:Object(l.jsx)(N,{})})]}),this.renderList("instances",je.ListEntry)]}),y.getFeatures().client&&Object(l.jsxs)("div",{className:"clients list",children:[Object(l.jsxs)("div",{className:"title",children:[Object(l.jsx)("h2",{children:"Clients"}),Object(l.jsx)(c.b,{to:"/new/client",children:Object(l.jsx)(N,{})})]}),this.renderList("clients",Oe.ListEntry)]}),y.getFeatures().plugin&&Object(l.jsxs)("div",{className:"plugins list",children:[Object(l.jsxs)("div",{className:"title",children:[Object(l.jsx)("h2",{children:"Plugins"}),y.getFeatures().plugin_upload&&Object(l.jsx)(c.b,{to:"/new/plugin",children:Object(l.jsx)(N,{})})]}),this.renderList("plugins",ye.ListEntry)]})]}),Object(l.jsx)("div",{className:"topbar",onClick:e=>this.setState({sidebarOpen:!this.state.sidebarOpen}),children:Object(l.jsxs)("div",{className:"hamburger "+(this.state.sidebarOpen?"active":""),children:[Object(l.jsx)("span",{}),Object(l.jsx)("span",{}),Object(l.jsx)("span",{})]})}),Object(l.jsx)("main",{className:"view",children:Object(l.jsxs)(o.d,{children:[Object(l.jsx)(o.b,{path:"/",exact:!0,render:()=>Object(l.jsx)(we,{openLog:this.openLog})}),Object(l.jsx)(o.b,{path:"/new/instance",render:()=>Object(l.jsx)(je,{onChange:e=>this.add("instances",e),entry:{},ctx:this.state})}),Object(l.jsx)(o.b,{path:"/new/client",render:()=>Object(l.jsx)(Oe,{onChange:e=>this.add("clients",e),entry:{},ctx:this.state})}),Object(l.jsx)(o.b,{path:"/new/plugin",render:()=>Object(l.jsx)(ye,{onChange:e=>this.add("plugins",e),entry:{},ctx:this.state})}),Object(l.jsx)(o.b,{path:"/instance/:id",render:({match:e})=>this.renderView("instances",je,e.params.id)}),Object(l.jsx)(o.b,{path:"/client/:id",render:({match:e})=>this.renderView("clients",Oe,e.params.id)}),Object(l.jsx)(o.b,{path:"/plugin/:id",render:({match:e})=>this.renderView("plugins",ye,e.params.id)}),Object(l.jsx)(o.b,{render:()=>this.renderNotFound()})]})})]})}renderModal(){return Object(l.jsx)(ke,{ref:e=>this.logModal=e,children:Object(l.jsx)($e,{lines:this.state.logLines,focus:this.state.logFocus})})}render(){return Object(l.jsxs)(l.Fragment,{children:[this.renderMain(),this.renderModal()]})}}var Ae=Object(o.g)(_e);class Te extends a.Component{constructor(e,t){super(e,t),this.inputChanged=e=>this.setState({[e.target.name]:e.target.value}),this.login=async e=>{e.preventDefault(),this.setState({loading:!0});const t=await y.login(this.state.username,this.state.password);t.token?await this.props.onLogin(t.token):t.error?this.setState({error:t.error,loading:!1}):(this.setState({error:"Unknown error",loading:!1}),console.log("Unknown error:",t))},this.state={username:"",password:"",loading:!1,error:""}}render(){return y.getFeatures().login?Object(l.jsx)("div",{className:"login-wrapper",children:Object(l.jsxs)("form",{className:`login ${this.state.error&&"errored"}`,onSubmit:this.login,children:[Object(l.jsx)("h1",{children:"Maubot Manager"}),Object(l.jsx)("input",{type:"text",placeholder:"Username",value:this.state.username,name:"username",onChange:this.inputChanged}),Object(l.jsx)("input",{type:"password",placeholder:"Password",value:this.state.password,name:"password",onChange:this.inputChanged}),Object(l.jsx)("button",{onClick:this.login,type:"submit",children:this.state.loading?Object(l.jsx)(d,{}):"Log in"}),this.state.error&&Object(l.jsx)("div",{className:"error",children:this.state.error})]})}):Object(l.jsx)("div",{className:"login-wrapper",children:Object(l.jsxs)("div",{className:"login errored",children:[Object(l.jsx)("h1",{children:"Maubot Manager"}),Object(l.jsx)("div",{className:"error",children:"Login has been disabled in the maubot config."})]})})}}var Fe=Te;class Ie extends a.Component{constructor(e){super(e),this.login=async e=>{localStorage.accessToken=e,await this.ping()},this.state={pinged:!1,authed:!1}}async componentDidMount(){await this.getBasePath(),localStorage.accessToken?await this.ping():await y.remoteGetFeatures(),this.setState({pinged:!0})}async getBasePath(){try{const e=await fetch("./paths.json",{headers:{"Content-Type":"application/json"}}),t=(await e.json()).api_path;y.setBasePath(`${t}`)}catch(e){console.error("Failed to get API path:",e)}}async ping(){try{const e=await y.ping();e?(localStorage.username=e,this.setState({authed:!0})):delete localStorage.accessToken}catch(e){console.error(e)}}render(){return this.state.pinged?Object(l.jsx)(c.a,{children:Object(l.jsx)("div",{className:"maubot-wrapper "+(this.state.authed?"authenticated":""),children:Object(l.jsxs)(o.d,{children:[Object(l.jsx)(h,{path:"/login",render:()=>Object(l.jsx)(Fe,{onLogin:this.login}),authed:!this.state.authed,to:"/"}),Object(l.jsx)(h,{path:"/",component:Ae,authed:this.state.authed})]})})}):Object(l.jsx)(d,{className:"maubot-loading"})}}var Pe=Ie;r.a.render(Object(l.jsx)(Pe,{}),document.getElementById("root"))},64:function(e,t,s){}},[[143,1,2]]]);
//# sourceMappingURL=main.88f25e04.chunk.js.map